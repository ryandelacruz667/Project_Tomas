<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="./resources/ol.css">
        <link rel="stylesheet" href="resources/fontawesome-all.min.css">
        <link href="resources/photon-geocoder-autocomplete.min.css" rel="stylesheet">
        <link rel="stylesheet" href="./resources/ol-layerswitcher.css">
        <link rel="stylesheet" href="./resources/qgis2web.css">
        <!-- Bootstrap Icons -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
        <!-- Bootstrap CSS for alert styles -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <!-- Bootstrap JS for offcanvas -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
        <style>
        html, body {
            background-color: #ffffff;
        }
        .ol-control > * {
            background-color: #f8f8f8!important;
            color: #444444!important;
            border-radius: 0px;
        }
        .ol-attribution a, .gcd-gl-input::placeholder, .search-layer-input-search::placeholder {
            color: #444444!important;
        }
        .search-layer-input-search {
            background-color: #f8f8f8!important;
        }
        .ol-control > *:focus, .ol-control >*:hover {
            background-color: rgba(248, 248, 248, 0.7)!important;
        } 
        .ol-control {
            background-color: rgba(255,255,255,.4) !important;
            padding: 2px !important;
        } 
        </style>

        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }

        body, html {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        #main-wrapper {
            display: flex;
            flex-direction: row;
            height: 100vh;
            width: 100vw;
            position: relative;
        }

        #left-pane {
            width: 320px;
            background: #23272f;
            color: #fff;
            height: 100vh;
            box-shadow: 2px 0 8px rgba(34,34,34,0.04);
            display: flex;
            flex-direction: column;
            padding: 0;
            z-index: 10;
            overflow: hidden;
            position: fixed;
            left: 0;
            top: 0;
        }
        
        /* Right pane removed - no longer needed */
        
        /* Family table styling */
        #family-table table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 8px;
            overflow: hidden;
            font-size: 0.9rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        #family-table th, #family-table td {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: left;
        }
        
        #family-table th {
            background: #1e88e5;
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        #family-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.05);
        }
        
        #family-table tr:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        #family-table td {
            color: #fafafa;
        }
        
        #family-table p {
            color: #fafafa;
            text-align: center;
            padding: 1rem;
            margin: 0;
        }
        
        /* Ensure all child elements inherit the dark background */
        #left-pane * {
            background-color: inherit;
        }
        
        /* Override any white backgrounds that might be inherited */
        #left-pane .sidebar-header,
        #left-pane .nav-bar,
        #left-pane .flood-section,
        #left-pane .flood-form-group,
        #left-pane .flood-legend-section {
            background: #23272f !important;
        }
        .sidebar-header {
            font-size: 1.6rem;
            font-weight: 700;
            text-align: left;
            padding: 1.5rem 1.5rem 0.8rem 1.5rem;
            letter-spacing: 0.3px;
            border-bottom: none;
            color: #fafafa;
            background: #23272f;
        }
        .sidebar-header span {
            border-bottom: 3px solid #24b2ff;
            padding-bottom: 0.2rem;
            color: #24b2ff;
            font-size: 1.3rem;
            display: inline-block;
            letter-spacing: 0.5px;
        }
        .sidebar-header.flood-header {
            /* Same as .sidebar-header but separate class for Flood Extent */
            font-size: 1.6rem;
            font-weight: 700;
            text-align: left;
            padding: 1.5rem 1.5rem 0.8rem 1.5rem;
            letter-spacing: 0.3px;
            border-bottom: none;
            color: #fafafa;
            background: #23272f;
        }
        .sidebar-header.flood-header span {
            border-bottom: 3px solid #f39c12;
            padding-bottom: 0.2rem;
            color: #f39c12;
            font-size: 1.3rem;
            display: inline-block;
            letter-spacing: 0.5px;
        }
        .nav-bar {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            margin-top: 1rem;
            padding: 0 1.2rem;
        }
        .nav-btn {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.7rem 1rem;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            outline: none;
            background: none;
            color: #fafafa;
            transition: background 0.18s, color 0.18s;
            border-radius: 8px;
            cursor: pointer;
            letter-spacing: 0.5px;
        }
        .nav-btn i {
            font-size: 1.2rem;
        }
        .nav-btn:hover, .nav-btn.active {
            background: #24b2ff;
            color: #fff;
        }
        .nav-btn.is-disabled {
            opacity: 0.45;
            cursor: not-allowed;
            pointer-events: none;
            background: rgba(36, 178, 255, 0.08);
            color: #8d939f;
        }
        button.is-disabled {
            opacity: 0.5;
            cursor: not-allowed !important;
            pointer-events: none;
        }
        /* Flood hazard section style */
        .flood-section {
            margin-top: 1.5rem;
        }
        .flood-form-group {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
            margin: 0 1.5rem 1rem 1.5rem;
        }
        .flood-form-label {
            font-size: 1.03rem;
            color: #f39c12;
            font-weight: 600;
            margin-bottom: 0.35rem;
            margin-left: 2px;
            letter-spacing: 0.5px;
        }
        .flood-modern-select {
            padding: 0.6rem 1rem;
            border: none;
            border-radius: 8px;
            background: #262a33;
            color: #fafafa;
            font-size: 1.08rem;
            font-weight: 500;
            outline: none;
            transition: background 0.14s;
            min-width: 135px;
            box-shadow: 0 0 0 1px #222326;
            position: relative;
            z-index: 1; /* Below charts panel (999) and table (1001) */
            overflow: visible;
        }
        .flood-modern-select:focus {
            background: #181b1f;
            box-shadow: 0 0 0 1.5px #f39c12;
            z-index: 100; /* Higher when focused to show dropdown options */
        }
        .flood-modern-select.is-disabled {
            opacity: 0.45;
            cursor: not-allowed;
        }
        .flood-divider {
            border: none;
            border-top: 2px solid #444;
            margin: 1.2rem 2rem 0.5rem 2rem;
        }
        
        /* Flood Legend Styles */
        .flood-legend-section {
            margin: 0.8rem 2rem 0.8rem 2rem;
        }
        .flood-legend-section:first-of-type {
            margin: 1.5rem 2rem 1rem 2rem;
        }
        .flood-legend {
            background: #262a33;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 0.5rem;
            border: 1px solid #333;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 0.6rem;
            padding: 0.3rem 0;
        }
        .legend-item:last-child {
            margin-bottom: 0;
        }
        .legend-icon {
            width: 20px;
            height: 20px;
            border-radius: 2px;
            flex-shrink: 0;
        }
        .legend-text {
            color: #fafafa;
            font-size: 0.95rem;
            font-weight: 500;
        }

        /* Top Pane Styles */
        #top-pane {
            position: fixed;
            left: 320px;
            top: 0;
            right: 600px; /* Account for right pane */
            height: 80px;
            background: #23272f;
            color: #fafafa;
            display: flex;
            align-items: center;
            z-index: 9;
            box-shadow: 0 2px 8px rgba(34,34,34,0.04);
            padding-left: 2.5rem;
            padding-right: 3rem;
        }
        
        .search-form {
            display: flex;
            align-items: center;
            gap: 1.8rem;
            width: 100%;
            max-width: 1200px;
            margin-left: 0;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            flex: 1 1 auto;
            min-width: 0;
        }
        .form-label {
            font-size: 0.95rem;
            color: #24b2ff;
            font-weight: 600;
            margin-bottom: 0.25rem;
            margin-left: 2px;
            letter-spacing: 0.4px;
            white-space: nowrap;
        }
        .modern-select {
            padding: 0.7rem 1.1rem;
            border: none;
            border-radius: 8px;
            background: #262a33;
            color: #fafafa;
            font-size: 1rem;
            font-weight: 500;
            outline: none;
            transition: all 0.14s ease;
            min-width: 180px;
            width: 100%;
            max-width: 220px;
            height: 42px;
            box-sizing: border-box;
            box-shadow: 0 0 0 1px #222326;
            position: relative;
            z-index: 1; /* Below charts panel (999) and table (1001) */
            overflow: visible;
        }
        .modern-select:hover {
            background: #2a2e37;
            box-shadow: 0 0 0 1px #3a3f4a;
        }
        .modern-select:focus {
            background: #181b1f;
            box-shadow: 0 0 0 2px #24b2ff;
            z-index: 100; /* Higher when focused to show dropdown options */
        }
        .modern-multiselect {
            position: relative;
            min-width: 180px;
            width: 100%;
            max-width: 220px;
        }
        .multiselect-button {
            width: 100%;
            text-align: left;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
        }
        .multiselect-button::after {
            content: '\25BC';
            font-size: 0.8rem;
            color: #9aa0ae;
            transition: transform 0.2s ease;
        }
        .multiselect-button.is-open::after {
            transform: rotate(180deg);
        }
        .multiselect-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: 0;
            width: max-content;
            min-width: 180px;
            max-width: 280px;
            background: #262a33;
            border-radius: 10px;
            border: 1px solid #3a3f4a;
            padding: 0.6rem 0.85rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            display: none;
            max-height: 320px;
            overflow-y: auto;
            overflow-x: hidden;
            z-index: 150;
        }
        /* Custom scrollbar for multiselect dropdown */
        .multiselect-dropdown::-webkit-scrollbar {
            width: 8px;
        }
        .multiselect-dropdown::-webkit-scrollbar-track {
            background: #1e2229;
            border-radius: 4px;
        }
        .multiselect-dropdown::-webkit-scrollbar-thumb {
            background: #3a3f4a;
            border-radius: 4px;
        }
        .multiselect-dropdown::-webkit-scrollbar-thumb:hover {
            background: #4a4f5a;
        }
        .multiselect-dropdown.is-open {
            display: block;
            animation: dropdownFade 0.18s ease;
        }
        .multiselect-option {
            display: flex;
            align-items: center;
            gap: 0.65rem;
            padding: 0.55rem 0.5rem;
            border-radius: 6px;
            transition: background 0.14s ease, color 0.14s ease;
            margin-bottom: 2px;
        }
        .multiselect-option:hover {
            background: rgba(36, 178, 255, 0.12);
        }
        .multiselect-option:last-child {
            margin-bottom: 0;
        }
        .multiselect-option input[type="checkbox"] {
            accent-color: #24b2ff;
            width: 17px;
            height: 17px;
            flex-shrink: 0;
            cursor: pointer;
        }
        .multiselect-option label {
            flex: 1;
            color: #e1e4eb;
            font-size: 0.94rem;
            cursor: pointer;
            user-select: none;
            line-height: 1.4;
            word-break: break-word;
        }
        .multiselect-empty {
            text-align: center;
            padding: 0.8rem 0.5rem;
            color: #9aa0ae;
            font-size: 0.91rem;
            font-style: italic;
        }
        @keyframes dropdownFade {
            from {
                opacity: 0;
                transform: translateY(-6px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .search-btn {
            padding: 0.65rem 2.1rem;
            border: none;
            border-radius: 10px;
            background: #24b2ff;
            color: #fff;
            font-size: 1.13rem;
            font-weight: 700;
            letter-spacing: 1px;
            cursor: pointer;
            transition: background 0.12s, box-shadow 0.15s;
            margin-left: 1.4rem;
            box-shadow: 0 2px 8px rgba(36,178,255,0.09);
        }
        .search-btn:hover {
            background: #189fd1;
            box-shadow: 0 2px 14px rgba(36,178,255,0.13);
        }

        /* Map container adjustments */
        #map-container {
            position: fixed;
            left: 320px;
            top: 80px; /* Below top-pane */
            right: 0; /* No right pane */
            bottom: 0;
            width: calc(100vw - 320px); /* 320px left only */
            height: calc(100vh - 80px);
            transition: left 0.3s ease, right 0.3s ease, width 0.3s ease;
        }
        
        /* Adjust map container when navigation bar is visible */
        #map-container.nav-bar-visible {
            top: calc(80px + var(--nav-bar-height, 0px)); /* Account for navigation bar height */
            height: calc(100vh - 80px - var(--nav-bar-height, 0px));
        }
        
        /* Right offcanvas removed - no map adjustments needed */
        /* #map-container.offcanvas-open {
            right: 400px;
            width: calc(100vw - 720px);
            transition: right 0.3s ease, width 0.3s ease;
        } */
        
        /* Charts panel adjustments */
        #map-container.charts-open {
            right: 400px; /* 400px charts panel only */
            width: calc(100vw - 720px); /* 320px left + 400px charts */
        }
        
        /* Charts panel adjustments - right offcanvas removed */
        /* #map-container.charts-open.offcanvas-open {
            right: 800px;
            width: calc(100vw - 1120px);
        } */
        
        #charts-panel {
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            overflow-x: hidden;
            overflow-y: hidden;
            box-sizing: border-box;
            max-width: 100%;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 80px); /* Full viewport height minus top bar */
        }
        
        /* Contain all chart content within panel - use flex to fill height */
        #charts-panel > div {
            max-width: 100%;
            box-sizing: border-box;
            overflow: hidden;
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        /* Chart container divs - fill available height */
        #charts-panel > div > div {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
            overflow: hidden !important;
            flex: 1;
            min-height: 0;
            position: relative;
        }
        
        #charts-panel canvas {
            max-width: 100% !important;
            max-height: 100% !important;
            width: 100% !important;
            height: 100% !important;
            box-sizing: border-box !important;
            display: block;
        }
        
        /* Modern charts panel styling */
        #charts-panel h4 {
            color: #f39c12;
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid rgba(243, 156, 18, 0.3);
            padding-bottom: 0.5rem;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        /* Ensure no white background shows when panel is hidden */
        body {
            background-color: #1e2329 !important;
            overflow-x: hidden;
        }
        
        html {
            background-color: #1e2329 !important;
        }

        /* Top Navigation Bar - Contains all population exposure table elements */
        #top-navigation-bar {
            display: none; /* shown when 24m is selected */
            position: fixed;
            top: 80px; /* Below top-pane */
            left: 320px; /* Account for left pane */
            right: 0; /* No right pane */
            background: linear-gradient(135deg, rgba(35, 39, 47, 0.98) 0%, rgba(42, 47, 57, 0.98) 100%);
            color: #fafafa;
            border-bottom: 2px solid rgba(243, 156, 18, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 950; /* Below modals (1000) but above charts panel (999) */
            transition: right 0.3s ease, left 0.3s ease, width 0.3s ease;
            max-height: calc(100vh - 80px);
            overflow-y: auto;
            overflow-x: hidden;
            box-sizing: border-box;
        }
        
        /* Right offcanvas removed - no navigation bar adjustments needed */
        /* #map-container.offcanvas-open #top-navigation-bar {
            right: 400px !important;
        } */
        
        /* Adjust navigation bar when charts panel is open */
        #map-container.charts-open #top-navigation-bar {
            right: 400px !important; /* 400px charts panel */
        }
        
        /* Right offcanvas removed - no combined adjustments needed */
        /* #map-container.charts-open.offcanvas-open #top-navigation-bar {
            right: 800px !important;
        } */
        
        /* Bootstrap Offcanvas Custom Styling - DISABLED: Right offcanvas removed */
        /*
        #offcanvasRight {
            width: 400px;
            background: #23272f;
            color: #fff;
        }
        
        #offcanvasRight .offcanvas-header {
            background: #24b2ff;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        #offcanvasRight .offcanvas-title {
            color: #fff;
            font-weight: 700;
        }
        
        #offcanvasRight .btn-close {
            filter: invert(1);
        }
        
        #offcanvasRight .offcanvas-body {
            background: #23272f;
            overflow-y: auto;
        }
        
        #offcanvasRight #right-pane-charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 16px;
            padding: 0;
        }
        
        #offcanvasRight .right-pane-chart-wrapper {
            width: 100%;
            height: 250px;
            position: relative;
            background: rgba(42, 47, 57, 0.4);
            border-radius: 8px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        #offcanvasRight .right-pane-chart-wrapper > div {
            position: relative;
            width: 100%;
            flex: 1;
            min-height: 0;
        }
        
        #offcanvasRight .right-pane-chart-wrapper canvas {
            max-width: 100% !important;
            max-height: 100% !important;
            width: 100% !important;
            height: 100% !important;
        }
        
        #offcanvasRight .age-chart-wrapper {
            height: 250px;
        }
        
        #offcanvasRight .right-pane-chart-wrapper h4 {
            margin: 0 0 8px 0;
            text-align: center;
            flex-shrink: 0;
        }
        */
        
        /* Bootstrap Offcanvas Bottom Custom Styling */
        #offcanvasBottom {
            height: 400px;
            width: calc(100vw - 320px); /* Match map container width */
            left: 320px; /* Align with map container */
            background: #23272f;
            color: #fff;
            transition: width 0.3s ease, left 0.3s ease;
        }
        
        /* Adjust bottom offcanvas width when charts panel is open */
        #map-container.charts-open ~ #offcanvasBottom {
            width: calc(100vw - 720px); /* Match map container width when charts open */
        }
        
        #offcanvasBottom .offcanvas-header {
            background: #24b2ff;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        #offcanvasBottom .offcanvas-title {
            color: #fff;
            font-weight: 700;
        }
        
        #offcanvasBottom .btn-close {
            filter: invert(1);
        }
        
        #offcanvasBottom .offcanvas-body {
            background: #23272f;
            overflow-y: auto;
            padding: 1.5rem;
        }
        
        /* Charts container in bottom offcanvas - Horizontal layout */
        #offcanvasBottom #bottom-pane-charts-container {
            display: flex;
            flex-direction: row;
            gap: 16px;
            padding: 1rem 0;
            overflow-x: auto;
            overflow-y: hidden;
            justify-content: space-around;
            align-items: stretch;
        }
        
        /* Chart wrapper in bottom offcanvas */
        #offcanvasBottom .bottom-chart-wrapper {
            flex: 1;
            min-width: 200px;
            max-width: 300px;
            height: 250px;
            position: relative;
            background: rgba(42, 47, 57, 0.4);
            border-radius: 8px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        #offcanvasBottom .bottom-chart-wrapper > div {
            position: relative;
            width: 100%;
            flex: 1;
            min-height: 0;
        }
        
        #offcanvasBottom .bottom-chart-wrapper canvas {
            max-width: 100% !important;
            max-height: 100% !important;
            width: 100% !important;
            height: 100% !important;
        }
        
        #offcanvasBottom .bottom-chart-wrapper h4 {
            text-align: center;
            flex-shrink: 0;
        }
        
        /* Impact Report Charts Container - Horizontal layout */
        /* Impact Report Offcanvas Styling */
        #offcanvasImpactReport {
            height: 400px;
            width: calc(100vw - 320px); /* Match map container width */
            left: 320px; /* Align with map container */
            background: #23272f;
            color: #fff;
            transition: width 0.3s ease, left 0.3s ease;
        }
        
        /* Adjust impact report offcanvas width when charts panel is open */
        #map-container.charts-open ~ #offcanvasImpactReport {
            width: calc(100vw - 720px); /* Match map container width when charts open */
        }
        
        #offcanvasImpactReport .offcanvas-header {
            background: #24b2ff;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        #offcanvasImpactReport .offcanvas-title {
            color: #fff;
            font-weight: 700;
        }
        
        #offcanvasImpactReport .btn-close {
            filter: invert(1);
        }
        
        #offcanvasImpactReport .offcanvas-body {
            background: #23272f;
            overflow-y: auto;
            padding: 1.5rem;
        }
        
        #offcanvasImpactReport #impact-report-charts-container {
            display: flex;
            flex-direction: row;
            gap: 16px;
            padding: 1rem 0;
            overflow-x: auto;
            overflow-y: hidden;
            justify-content: space-around;
            align-items: stretch;
        }
        
        #offcanvasImpactReport .bottom-chart-wrapper {
            flex: 1;
            min-width: 200px;
            max-width: 300px;
            display: flex;
            flex-direction: column;
            background: rgba(42, 47, 57, 0.5);
            border-radius: 8px;
            padding: 12px;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        #offcanvasImpactReport .bottom-chart-wrapper > div {
            position: relative;
            width: 100%;
            flex: 1;
            min-height: 0;
        }
        
        #offcanvasImpactReport .bottom-chart-wrapper canvas {
            max-width: 100% !important;
            max-height: 100% !important;
            width: 100% !important;
            height: 100% !important;
        }
        
        #offcanvasImpactReport .bottom-chart-wrapper h4 {
            text-align: center;
            flex-shrink: 0;
        }
        
        /* Adjust map container when bottom offcanvas is shown */
        #map-container.offcanvas-bottom-open {
            bottom: 400px; /* Account for bottom offcanvas height */
            height: calc(100vh - 90px - 400px); /* 90px for navbar, 400px for offcanvas */
        }
        
        #top-navigation-bar .nav-content {
            padding: 1rem 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            width: 100%;
            box-sizing: border-box;
        }
        
        /* Navigation bar header */
        #top-navigation-bar .nav-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        #top-navigation-bar #people-table-title {
            margin: 0;
            color: #f39c12;
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        #top-navigation-bar #people-table-count {
            font-size: 0.9rem;
            color: #cccccc;
            font-weight: 500;
            margin-left: 8px;
        }
        
        /* Navigation bar filters */
        #top-navigation-bar #people-filters {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        /* Navigation bar table wrapper */
        #top-navigation-bar #people-table-wrapper {
            overflow-y: auto;
            overflow-x: auto;
            background: rgba(42, 47, 57, 0.5);
            border: 1px solid rgba(243, 156, 18, 0.2);
            border-radius: 8px;
            max-height: calc(100vh - 300px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            width: 100%;
            box-sizing: border-box;
        }
        
        /* Ensure all navigation bar child elements are responsive */
        #top-navigation-bar .nav-content,
        #top-navigation-bar #people-table-wrapper,
        #top-navigation-bar #people-24-table-inner {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box;
        }
        
        /* Ensure table and its container are responsive */
        #people-24-table-inner {
            width: 100% !important;
            max-width: 100% !important;
            overflow-x: auto;
            box-sizing: border-box;
            table-layout: auto; /* Allow table to adjust column widths */
        }
        
        #people-table-wrapper {
            width: 100% !important;
            max-width: 100% !important;
            overflow-x: auto !important;
            overflow-y: auto !important;
            box-sizing: border-box;
        }
        
        /* Responsive adjustments when charts panel is open */
        #map-container.charts-open #top-navigation-bar .nav-content {
            padding-right: 0.5rem; /* Small gap from charts */
        }
        
        /* Set specific column widths for better fit */
        #people-24-table-inner th:nth-child(1),
        #people-24-table-inner td:nth-child(1) {
            width: 5%;
        }
        #people-24-table-inner th:nth-child(2),
        #people-24-table-inner td:nth-child(2) {
            width: 20%;
        }
        #people-24-table-inner th:nth-child(3),
        #people-24-table-inner td:nth-child(3),
        #people-24-table-inner th:nth-child(4),
        #people-24-table-inner td:nth-child(4),
        #people-24-table-inner th:nth-child(5),
        #people-24-table-inner td:nth-child(5),
        #people-24-table-inner th:nth-child(6),
        #people-24-table-inner td:nth-child(6),
        #people-24-table-inner th:nth-child(7),
        #people-24-table-inner td:nth-child(7),
        #people-24-table-inner th:nth-child(8),
        #people-24-table-inner td:nth-child(8),
        #people-24-table-inner th:nth-child(9),
        #people-24-table-inner td:nth-child(9) {
            width: 7%;
        }
        #people-24-table-inner th:nth-child(10),
        #people-24-table-inner td:nth-child(10) {
            width: 7%;
        }
        #people-24-table-inner th:nth-child(11),
        #people-24-table-inner td:nth-child(11) {
            width: 15%;
        }

        /* Lower pane removed - map is now directly in map-container */
        #map {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        /* Flood Data Table Styles */
        #flood-data-table {
            position: fixed;
            top: 90px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(35, 39, 47, 0.95);
            color: #fafafa;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
            max-width: 80%;
            max-height: 60vh;
            overflow-y: auto;
            display: none;
        }
        
        #flood-data-table h3 {
            margin: 0 0 1rem 0;
            color: #f39c12;
            font-size: 1.4rem;
            font-weight: 700;
            text-align: center;
            border-bottom: 2px solid #f39c12;
            padding-bottom: 0.5rem;
        }
        
        .flood-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            table-layout: fixed;
        }
        
        .flood-table th {
            background: #2a2f39;
            color: #f39c12;
            padding: 0.6rem 0.4rem;
            text-align: center;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            border: 1px solid #444;
        }
        
        /* Modal Styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none; /* Allow clicks to pass through to map */
        }
        
        .modal-content {
            background: #2a2f39;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            pointer-events: auto; /* Enable interaction with modal content */
        }

/* Maximize behavior for infographics modal */
.modal-content.maximized {
    width: 100% !important;
    max-width: none !important;
    height: 95vh !important;
}

        /* Simple loading spinner */
        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid #3a3f4a;
            border-top-color: #f39c12;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loading-wrap {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #1e2329;
        }
        .inline-error {
            color: #ff7675;
            background: #2a2f39;
            border: 1px solid #3a3f4a;
            padding: 12px 14px;
            border-radius: 8px;
            text-align: center;
        }

        /* Bright blue glow on hover for buttons */
        button, .nav-btn, .close-btn {
            transition: box-shadow 0.2s ease, border-color 0.2s ease;
        }
        button:hover, .nav-btn:hover, .close-btn:hover {
            border-color: #3ea8ff !important;
            box-shadow: 0 0 0 2px rgba(62, 168, 255, 0.35), 0 0 10px rgba(62, 168, 255, 0.6) inset;
        }

        /* Chat widget */
        .ai-chat-toggle {
            position: fixed;
            right: 20px;
            bottom: 20px;
            z-index: 1200;
            background: #2a2f39;
            color: #fff;
            border: 1px solid #3a3f4a;
            padding: 10px 12px;
            border-radius: 999px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.4);
        }
        .ai-chat-callout {
            position: fixed;
            right: 92px; /* 20px (edge) + ~72px (toggle total width) */
            bottom: 28px;
            z-index: 1200;
            background: #243447;
            color: #ffffff;
            border: 1px solid #355070;
            border-radius: 22px;
            padding: 10px 14px;
            font-size: 14px;
            font-weight: 600;
            line-height: 1;
            white-space: nowrap;
            box-shadow: 0 6px 18px rgba(0,0,0,0.35);
            animation: aiCalloutPulse 2s ease-in-out infinite;
            transition: box-shadow 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
        }
        .ai-chat-callout::after {
            content: '';
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 0; height: 0;
            border-left: 6px solid #243447;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }
        .ai-chat-callout:hover {
            border-color: #3ea8ff !important;
            box-shadow: 0 0 0 2px rgba(62, 168, 255, 0.35), 0 0 10px rgba(62, 168, 255, 0.6) inset, 0 8px 22px rgba(0,0,0,0.45);
            transform: translateY(-2px);
        }
        @keyframes aiCalloutPulse {
            0%, 100% { transform: translateY(0); box-shadow: 0 6px 18px rgba(0,0,0,0.35); }
            50% { transform: translateY(-2px); box-shadow: 0 8px 22px rgba(0,0,0,0.45); }
        }
        .ai-chat-panel {
            position: fixed;
            right: 20px;
            bottom: 76px;
            width: 340px;
            max-height: 70vh;
            display: none;
            flex-direction: column;
            background: #1e2329;
            border: 1px solid #3a3f4a;
            border-radius: 12px;
            overflow: hidden;
            z-index: 1200;
            box-shadow: 0 12px 30px rgba(0,0,0,0.5);
        }
        .ai-chat-header {
            padding: 10px 12px;
            background: #161b22;
            border-bottom: 1px solid #2a2f39;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .ai-chat-title { color: #f39c12; font-weight: 700; }
        .ai-chat-actions { display: flex; gap: 6px; }
        .ai-chat-body {
            padding: 10px 12px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 52vh;
        }
        .ai-msg { padding: 8px 10px; border-radius: 10px; max-width: 85%; }
        .ai-msg.user { background: #243447; align-self: flex-end; border: 1px solid #355070; }
        .ai-msg.assistant { background: #2a2f39; align-self: flex-start; border: 1px solid #3a3f4a; }
        .ai-chat-input {
            display: flex;
            gap: 8px;
            padding: 10px 12px;
            border-top: 1px solid #2a2f39;
            background: #1e2329;
        }
        .ai-chat-input input {
            flex: 1 1 auto;
            background: #14181d;
            color: #fff;
            border: 1px solid #3a3f4a;
            border-radius: 8px;
            padding: 8px 10px;
        }
        .ai-chat-input button { border-radius: 8px; background:#2a2f39; color:#fff; border:1px solid #3a3f4a; padding: 8px 10px; cursor: pointer; }
        .ai-key-hint { color:#8aa0b4; font-size: 12px; padding: 6px 12px; border-top: 1px dashed #2a2f39; }
        
        .modal-header {
            cursor: move;
            user-select: none;
        }
        
        .modal-header:hover {
            background: #252a33;
        }
        
        .modal-header {
            background: #1e2329;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #f39c12;
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: #ccc;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .close-btn:hover {
            background-color: #444;
            color: #fff;
        }
        
        .modal-body {
            padding: 1.5rem;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .household-table {
            width: 100%;
            border-collapse: collapse;
            background: #1e2329;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .household-table th {
            background: #2a2f39;
            color: #fafafa;
            font-weight: 600;
            padding: 0.75rem 0.5rem;
            text-align: left;
            border-bottom: 2px solid #444;
            font-size: 0.9rem;
        }
        
        .household-table td {
            padding: 0.6rem 0.5rem;
            border-bottom: 1px solid #333;
            color: #e0e0e0;
            font-size: 0.85rem;
        }
        
        .household-table tbody tr:hover {
            background-color: #2a2f39;
        }
        
        .household-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .flood-table td {
            padding: 0.5rem 0.4rem;
            border: 1px solid #444;
            background: rgba(42, 47, 57, 0.5);
            color: #ffffff;
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .flood-table tr:nth-child(even) td {
            background: rgba(42, 47, 57, 0.7);
        }
        
        .flood-table tr:hover td {
            background: rgba(243, 156, 18, 0.1);
        }
        .flood-table tbody tr.household-row-selected td {
            background: rgba(243, 156, 18, 0.25);
            color: #fff5d6;
            font-weight: 600;
        }
        
        .close-table-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: #fafafa;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }
        
        .close-table-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Layer Switcher Styles */
        .layer-switcher {
            background: rgba(35, 39, 47, 0.95);
            color: #fafafa;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .layer-switcher .panel {
            background: rgba(35, 39, 47, 0.95);
        }
        
        .layer-switcher label {
            color: #fafafa;
        }
        
        .layer-switcher input[type="checkbox"]:checked + label {
            color: #24b2ff;
        }

        /* Responsive Design - Multiple Screen Sizes */
        @media (max-width: 1400px) {
            #charts-panel {
                width: 350px;
            }
            #map-container.charts-open {
                right: 950px; /* 600px right pane + 350px charts panel */
                width: calc(100vw - 1270px); /* 320px left + 600px right + 350px charts */
            }
        }

        @media (max-width: 1200px) {
            #charts-panel {
                width: 300px;
            }
            #map-container.charts-open {
                right: 900px; /* 600px right pane + 300px charts panel */
                width: calc(100vw - 1220px); /* 320px left + 600px right + 300px charts */
            }
            #top-navigation-bar {
                max-height: 35vh;
            }
            #charts-panel {
                height: calc(100vh - 80px); /* Full height */
            }
        }

        @media (max-width: 1024px) {
            #charts-panel {
                width: 280px;
                padding: 1rem;
            }
            #map-container.charts-open {
                right: 880px; /* 600px right pane + 280px charts panel */
                width: calc(100vw - 1200px); /* 320px left + 600px right + 280px charts */
            }
            #top-navigation-bar {
                max-height: 30vh;
            }
            #charts-panel {
                height: calc(100vh - 80px); /* Full height */
            }
            #charts-panel h4 {
                font-size: 0.85rem;
            }
            /* Charts will flex to fill available height - no fixed heights */
            .flood-table {
                font-size: 0.75rem;
            }
            .flood-table th,
            .flood-table td {
                padding: 0.4rem 0.3rem;
            }
        }

        @media (max-width: 768px) {
            #left-pane {
                width: 280px;
            }
            #right-pane {
                width: 280px;
            }
            #map-container {
                left: 280px;
                right: 280px;
                width: calc(100vw - 560px);
            }
            #charts-panel {
                width: 250px;
                padding: 0.8rem;
            }
            #map-container.charts-open {
                left: 280px;
                right: 530px; /* 280px right pane + 250px charts panel */
                width: calc(100vw - 810px); /* 280px left + 280px right + 250px charts */
            }
            #top-navigation-bar {
                max-height: 25vh;
            }
            #charts-panel {
                height: calc(100vh - 80px); /* Full height */
            }
            /* Charts will flex to fill available height - no fixed heights */
            #people-filters {
                flex-direction: column;
                align-items: stretch !important;
            }
            #people-filters > div {
                width: 100%;
            }
            .modern-select {
                width: 100%;
                min-width: unset;
            }
        }

        @media (max-width: 640px) {
            #left-pane {
                width: 260px;
            }
            #map-container {
                left: 260px;
                width: calc(100vw - 260px);
            }
            #charts-panel {
                width: 100%;
                right: 0;
                top: 80px;
                bottom: 0;
                height: calc(100vh - 80px); /* Full height */
                border-left: none;
                border-top: 2px solid rgba(243, 156, 18, 0.3);
            }
            #map-container.charts-open {
                left: 260px;
                right: 0;
                width: calc(100vw - 260px);
                bottom: 0;
            }
            #top-navigation-bar {
                max-height: 30vh;
            }
            /* Charts will flex to fill available height - no fixed heights */
            .flood-modern-select,
            .modern-select {
                font-size: 0.95rem;
                padding: 0.5rem 0.8rem;
            }
        }

        /* Ensure selects in sidebar don't overflow charts */
        #left-pane select {
            max-width: 100%;
            box-sizing: border-box;
        }

        /* Prevent dropdowns from appearing over charts panel */
        #left-pane {
            position: relative;
            z-index: 100; /* Below table (950) and modals (1000) but above charts (999) when sidebar is open */
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* Ensure charts panel stays on top */
        #charts-panel {
            position: fixed;
            z-index: 999;
        }

        /* Ensure table stays above charts but below modals */
        
        /* Custom Popover Styles */
        .custom-popover {
            background-color: #2a2f39;
            border: 1px solid #f39c12;
            border-radius: 8px;
        }
        
        .custom-popover .popover-header {
            background-color: #f39c12;
            color: #fff;
            border-bottom: 1px solid #f39c12;
            font-weight: 600;
        }
        
        .custom-popover .popover-body {
            background-color: #2a2f39;
            color: #fafafa;
        }
        </style>
        <title>PROJECT TOMaS (Tactical Overlay for Mapping and Safety)</title>
    </head>
    <body>
        <div id="main-wrapper">
            <div id="left-pane">
                <div class="sidebar-header" style="background: #24b2ff; border-bottom: none; padding-bottom: 0.7rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 1.2rem; justify-content: center; text-align: center;">
                    <i class="fas fa-map-marked-alt" style="font-size: 2.1rem; color: #fff;"></i>
                    <div style="display: flex; flex-direction: column; align-items: center;">
                        <span style="font-size: 1.45rem; font-weight: 800; color: #fff; letter-spacing: 1.1px; line-height: 1; text-align: center;">PROJECT TOMaS</span>
                        <div style="font-size: 0.98rem; color: #e6e6e6; margin-top: 0.18rem; font-weight: 400; letter-spacing: 0.2px; font-style: italic; opacity: 0.95; text-align: center;">
                            (Tactical Overlay for Mapping and Safety)
                        </div>
                    </div>
                </div>
                <div class="sidebar-header">
                    <span>Database</span>
                </div>
                <nav class="nav-bar">
                    <button class="nav-btn" id="household-btn" title="Household">
                        <i class="fas fa-home"></i>
                        <span>Household</span>
                    </button>
                    <button class="nav-btn" title="ACVs">
                        <i class="fas fa-industry"></i>
                        <span>ACVs</span>
                    </button>
                    <button class="nav-btn" title="Equipment">
                        <i class="fas fa-cogs"></i>
                        <span>Equipment</span>
                    </button>
                    <button class="nav-btn" id="roads-btn" title="Roads &amp; Bridges">
                        <i class="fas fa-road"></i>
                        <span>Roads &amp; Bridges</span>
                    </button>
                    <button class="nav-btn" title="Evac Center">
                        <i class="fas fa-hospital"></i>
                        <span>Evac Center</span>
                    </button>
                    <button class="nav-btn" title="Buildings">
                        <i class="fas fa-building"></i>
                        <span>Buildings</span>
                    </button>
                    <button class="nav-btn" title="Schools">
                        <i class="fas fa-school"></i>
                        <span>Schools</span>
                    </button>
                    <button class="nav-btn" id="documentation-btn" title="Documentation">
                        <i class="fas fa-book"></i>
                        <span>Documentation</span>
                    </button>
                </nav>
                <!-- Flood Extent Dropdown Section Styled like Database Header -->
                <div class="flood-section">
                    <div class="sidebar-header flood-header">
                        <span>Flood Extent</span>
                    </div>
                    <div class="flood-form-group">
                        <label class="flood-form-label" for="floodExtentDropdown">Flood Extent</label>
                        <!-- 
                        FLOOD EXTENT DROPDOWN - ENABLED
                        HOW IT WORKS:
                        - Allows users to select flood extent levels (24-30 meters)
                        - When selected, displays corresponding flood layer PNGs on the map
                        - Triggers chart panel to appear showing hazard distribution
                        - Filters population exposure table and charts based on selected extent
                        - Enabled when at least one barangay is selected
                        -->
                        <select id="floodExtentDropdown" class="flood-modern-select">
                            <option value="">Select Flood Extent</option>
                            <option value="24">24 meters</option>
                            <option value="25">25 meters</option>
                            <option value="26">26 meters</option>
                            <option value="27">27 meters</option>
                            <option value="28">28 meters</option>
                            <option value="29">29 meters</option>
                            <option value="30">30 meters</option>
                        </select>
                        <button id="toggleInfographicsBtn" style="margin-top: 12px; padding: 0.5rem 0.8rem; border-radius: 8px; border: 1px solid #3a3f4a; background:#2a2f39; color:#fff; cursor:pointer; font-weight:600; width: 100%;">Impact Report</button>
                        <button type="button" id="impactReportBtn" class="btn btn-secondary" 
                                data-bs-toggle="popover" 
                                data-bs-placement="right"
                                data-bs-custom-class="custom-popover"
                                data-bs-title="Minimum Needs"
                                data-bs-content="Minimum Needs Under construction!"
                                style="margin-top: 8px; padding: 0.5rem 0.8rem; border-radius: 8px; border: 1px solid #3a3f4a; background:#2a2f39; color:#fff; cursor:pointer; font-weight:600; width: 100%;">Minimum Needs</button>
                    </div>
                            </div>
                            </div>
            <!-- Top Bar -->
            <div id="top-pane">
                <form class="search-form" autocomplete="off">
                    <div class="form-group">
                        <label class="form-label" for="region-multiselect-button">Region</label>
                        <div id="region-multiselect" class="modern-multiselect">
                            <button type="button" id="region-multiselect-button" class="modern-select multiselect-button">Select Region</button>
                            <div id="region-multiselect-dropdown" class="multiselect-dropdown">
                                <div class="multiselect-empty">Loading regions...</div>
                            </div>
                            </div>
                            </div>
                    <div class="form-group">
                        <label class="form-label" for="province-multiselect-button">Province</label>
                        <div id="province-multiselect" class="modern-multiselect">
                            <button type="button" id="province-multiselect-button" class="modern-select multiselect-button">Select Province</button>
                            <div id="province-multiselect-dropdown" class="multiselect-dropdown">
                                <div class="multiselect-empty">Select a region first</div>
                        </div>
                    </div>
                </div>
                    <div class="form-group">
                        <label class="form-label" for="municipality-multiselect-button">Municipality</label>
                        <div id="municipality-multiselect" class="modern-multiselect">
                            <button type="button" id="municipality-multiselect-button" class="modern-select multiselect-button">Select Municipality</button>
                            <div id="municipality-multiselect-dropdown" class="multiselect-dropdown">
                                <div class="multiselect-empty">Select a province first</div>
                    </div>
                    </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="barangay-multiselect-button">Barangay</label>
                        <div id="barangay-multiselect" class="modern-multiselect">
                            <button type="button" id="barangay-multiselect-button" class="modern-select multiselect-button">Select Barangay</button>
                            <div id="barangay-multiselect-dropdown" class="multiselect-dropdown">
                                <div class="multiselect-empty">Select a municipality first</div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <!-- Map Container -->
            <div id="map-container">
                <!-- Charts Panel (Right Side) -->
                <!-- 
                CHARTS PANEL - Partially Disabled
                HOW IT WORKS:
                - Pie chart (Hazard Level Distribution) is ENABLED and visible
                - Bar chart (Exposed Population by Age) is DISABLED (hidden but code preserved)
                - Flood exposure legend is DISABLED (hidden but code preserved)
                - Panel width adjusted to 400px since bar chart and legend are disabled
                - Appears when flood extent is selected (if enabled)
                
                DISABLED COMPONENTS:
                - Demographics bar chart: display: none applied
                - Flood exposure legend: display: none applied
                
                TO RE-ENABLE DISABLED COMPONENTS: Remove display: none from their style attributes
                -->
                <div id="charts-panel" style="display: none; position: fixed; right: 0; top: 80px; bottom: 0; height: auto; width: 400px; background: linear-gradient(135deg, rgba(35, 39, 47, 0.98) 0%, rgba(42, 47, 57, 0.98) 100%); border-left: 2px solid rgba(243, 156, 18, 0.3); z-index: 999; overflow-y: hidden; overflow-x: hidden; padding: 1.5rem; box-shadow: -4px 0 20px rgba(0, 0, 0, 0.4); box-sizing: border-box;">
                    <!-- Pie Chart Section - ENABLED -->
                    <div style="flex: 1; max-width: 100%; box-sizing: border-box; overflow: hidden; display: flex; flex-direction: column; min-height: 0; margin-bottom: 0.75rem;">
                        <h4>Hazard Level Distribution</h4>
                        <div style="position: relative; flex: 1; max-width: 100%; background: rgba(42, 47, 57, 0.4); border-radius: 8px; padding: 1rem; box-sizing: border-box; overflow: hidden; min-height: 0;">
                            <canvas id="hazardPieChart" style="max-width: 100%; max-height: 100%; box-sizing: border-box;"></canvas>
                        </div>
                    </div>
                        <!-- Flood Exposure Legend - DISABLED: Hidden but kept in code for future use -->
                        <!-- 
                        HOW IT WORKS (currently disabled):
                        - Displays flood exposure hazard levels (High, Moderate, Low, Very Low) with corresponding legend icons
                        - Shows beside the pie chart to help users interpret the hazard level distribution
                        - Uses flexbox layout to position legend to the right of the pie chart
                        - Styled to match the charts panel theme with dark background and accent colors
                        - Currently hidden via display: none to disable functionality without removing code
                        
                        TO RE-ENABLE: Remove display: none from the style attribute below
                        -->
                        <div style="flex: 0 0 auto; min-width: 140px; display: none; flex-direction: column;">
                            <h4 style="margin-bottom: 0.5rem; font-size: 0.9rem; color: #f39c12; font-weight: 600;">Flood Exposure</h4>
                            <div style="background: rgba(42, 47, 57, 0.4); border-radius: 8px; padding: 0.75rem; display: flex; flex-direction: column; gap: 6px;">
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <img src="styles/legend/Numberofpeopleat24meters_12_0.png" alt="High" style="width: 18px; height: 18px; flex-shrink: 0;" />
                                    <span style="color: #cccccc; font-size: 0.8em; line-height: 1.2;">High (> 1.5 m)</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <img src="styles/legend/Numberofpeopleat24meters_12_1.png" alt="Moderate" style="width: 18px; height: 18px; flex-shrink: 0;" />
                                    <span style="color: #cccccc; font-size: 0.8em; line-height: 1.2;">Moderate (> 0.7 - 1.5 m)</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <img src="styles/legend/Numberofpeopleat24meters_12_2.png" alt="Low" style="width: 18px; height: 18px; flex-shrink: 0;" />
                                    <span style="color: #cccccc; font-size: 0.8em; line-height: 1.2;">Low (> 0.1 - 0.7 m)</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <img src="styles/legend/Numberofpeopleat24meters_12_3.png" alt="Very Low" style="width: 18px; height: 18px; flex-shrink: 0;" />
                                    <span style="color: #cccccc; font-size: 0.8em; line-height: 1.2;">Very Low (<= 0.1 m)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Demographics Bar Chart - DISABLED: Hidden but kept in code for future use -->
                    <!-- 
                    HOW IT WORKS (currently disabled):
                    - Displays exposed population by age groups (Infant, Child, Youth, Adult, Elderly, Disabled)
                    - Shows as an interactive bar chart using Chart.js library
                    - Updates automatically when barangay or exposure level selections change
                    - Clicking bars filters the population exposure table to show matching demographics
                    - Currently hidden via display: none to disable functionality without removing code
                    
                    TO RE-ENABLE: Remove display: none from the style attribute below and ensure 
                    updateCharts() function includes bar chart creation logic
                    -->
                    <div style="flex: 1; max-width: 100%; box-sizing: border-box; overflow: hidden; display: none; flex-direction: column; min-height: 0;">
                        <h4>Exposed Population by Age</h4>
                        <div style="position: relative; flex: 1; max-width: 100%; background: rgba(42, 47, 57, 0.4); border-radius: 8px; padding: 1rem; box-sizing: border-box; overflow: hidden; min-height: 0;">
                            <canvas id="demographicsBarChart" style="max-width: 100%; max-height: 100%; box-sizing: border-box;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Top Navigation Bar - Contains all population exposure table elements -->
            <div id="top-navigation-bar" style="display: none;">
                <div class="nav-content">
                    <div class="nav-header">
                        <h3 id="people-table-title">
                            <span id="people-table-title-text">Population Exposure</span>
                            <span id="people-table-count">0 of 0 rows</span>
                        </h3>
                        <button id="people-24-close" class="close-table-btn" title="Close">&times;</button>
                    </div>
                    <!-- Filters -->
                    <div id="people-filters"></div>
                    
                    <!-- Table Wrapper -->
                    <div id="people-table-wrapper">
                        <table class="flood-table" id="people-24-table-inner" style="margin:0;">
                            <thead style="position: sticky; top: 0; z-index: 2;">
                                <tr>
                                    <th>No.</th>
                                    <th>Barangay</th>
                                    <th>Infant</th>
                                    <th>Child</th>
                                    <th>Youth</th>
                                    <th>Adult</th>
                                    <th>Elderly</th>
                                    <th>Male</th>
                                    <th>Female</th>
                                    <th>Disabled</th>
                                    <th>Flood Exposure</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div id="map-container">
                <!-- Household Details Modal -->
                    <div id="household-modal" class="modal" style="display: none;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3 id="household-modal-title">Household Details</h3>
                                <button id="household-modal-close" class="close-btn">&times;</button>
                            </div>
                            <div class="modal-body">
                                <div id="household-size-display" style="margin-bottom: 1rem; padding: 0.75rem; background: #1e2329; border-radius: 6px; border-left: 4px solid #f39c12;">
                                    <strong style="color: #f39c12;">Household Size: </strong>
                                    <span id="household-size-value" style="color: #e0e0e0;">-</span>
                                </div>
                                <div id="household-table-container">
                                    <table id="household-details-table" class="household-table">
                                        <thead>
                                            <tr>
                                                <th>Relation</th>
                                                <th>Given Name</th>
                                                <th>Last Name</th>
                                                <th>Age</th>
                                                <th>Sex</th>
                                                <th>Occupation</th>
                                                <th>Religion</th>
                                            </tr>
                                        </thead>
                                        <tbody id="household-details-tbody">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Infographics Modal -->
                    <div id="infographics-modal" class="modal" style="display: none;">
                        <div class="modal-content" style="width: 95%; max-width: 1000px; height: 85vh; display: flex; flex-direction: column;">
                            <div class="modal-header">
                                <h3 id="infographics-modal-title">Infographics</h3>
                                <div style="display:flex; gap:8px; align-items:center;">
                                    <button id="infographics-modal-maximize" class="close-btn" title="Maximize" style="line-height:1;"></button>
                                    <button id="infographics-modal-close" class="close-btn">&times;</button>
                                </div>
                            </div>
                            <div class="modal-body" style="flex: 1 1 auto; padding: 0;">
                                <div id="infographics-container" style="width:100%; height:100%; background:#1e2329; display:flex; align-items:center; justify-content:center;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Impact Report Modal -->
                    <div id="impact-report-modal" class="modal" style="display: none;">
                        <div class="modal-content" style="width: 95%; max-width: 1000px; height: 85vh; display: flex; flex-direction: column;">
                            <div class="modal-header">
                                <h3 id="impact-report-modal-title">Impact Report</h3>
                                <div style="display:flex; gap:8px; align-items:center;">
                                    <button id="impact-report-modal-maximize" class="close-btn" title="Maximize" style="line-height:1;"></button>
                                    <button id="impact-report-modal-close" class="close-btn">&times;</button>
                                </div>
                            </div>
                            <div class="modal-body" style="flex: 1 1 auto; padding: 0;">
                                <div id="impact-report-container" style="width:100%; height:100%; background:#1e2329; display:flex; align-items:center; justify-content:center;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Barangay Population Modal -->
                    <div id="barangay-population-modal" class="modal" style="display: none;">
                        <div class="modal-content" style="width: 90%; max-width: 700px; max-height: 85vh; display: flex; flex-direction: column;">
                            <div class="modal-header">
                                <h3 id="barangay-population-title">Population by Barangay</h3>
                                <button id="barangay-population-close" class="close-btn">&times;</button>
                            </div>
                            <div class="modal-body" style="flex: 1 1 auto; overflow: hidden;">
                                <div id="barangay-population-content" style="height: 100%; overflow-y: auto;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Family Members Modal -->
                    <div id="family-table-modal" class="modal" style="display: none;">
                        <div class="modal-content" id="family-table-modal-content" style="width: 90%; max-width: 900px; max-height: 85vh; display: flex; flex-direction: column;">
                            <div class="modal-header" id="family-table-modal-header">
                                <h3 id="family-table-modal-title">Household Members</h3>
                                <button id="family-table-modal-close" class="close-btn">&times;</button>
                            </div>
                            <div class="modal-body" style="overflow-y: auto; padding: 1.5rem;">
                                <div id="family-table"></div>
                            </div>
                        </div>
                    </div>
                    <div id="map">
                            <div>
                                <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                                <div id="popup-content"></div>
                            </div>
                            <!-- Barangay Tooltip -->
                        </div>
                        <!-- Map Legend - DISABLED: Hidden but kept in code for future use -->
                        <!-- 
                        HOW IT WORKS (currently disabled):
                        - Displays map legends showing water depth levels and their corresponding colors/icons
                        - Appears on the map when flood extent is selected
                        - Shows legend icons with depth values (0.0010m, 2.3258m, 4.6505m, 6.9753m, 9.3000m)
                        - Positioned at bottom-left of the map overlay
                        - Currently hidden via display: none to disable functionality without removing code
                        
                        TO RE-ENABLE: Change display: none to display: block in the style attribute below
                        and ensure setupFloodExtentListeners() function shows the legend when flood extent is selected
                        -->
                        <div id="map-legend" style="display: none; position: absolute; bottom: 20px; left: 20px; background: rgba(38, 42, 51, 0.2); border: 1px solid #666; border-radius: 8px; padding: 12px; width: auto; height: auto; min-width: fit-content; z-index: 1000;">
                            <div style="color: #1a1a1a; font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; text-align: center;">Legends</div>
                            <!-- Water Depth Legend - DISABLED: Hidden but kept in code for future use -->
                            <div style="margin-bottom: 8px; display: none;">
                                <div style="color: #1a1a1a; font-size: 0.85rem; font-weight: 500; margin-bottom: 4px; padding-bottom: 4px; border-bottom: 1px solid #999;">Water Depth</div>
                                <div style="display: flex; flex-direction: column; gap: 3px;">
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        <img src="styles/legend/24_10_0.png" alt="0.0010" style="width: 18px; height: 18px; padding: 4px;" />
                                        <span style="color: #1a1a1a; font-size: 0.85em;">0.0010m</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        <img src="styles/legend/24_10_1.png" alt="2.3258" style="width: 18px; height: 18px; padding: 4px;" />
                                        <span style="color: #1a1a1a; font-size: 0.85em;">2.3258m</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        <img src="styles/legend/24_10_2.png" alt="4.6505" style="width: 18px; height: 18px; padding: 4px;" />
                                        <span style="color: #1a1a1a; font-size: 0.85em;">4.6505m</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        <img src="styles/legend/24_10_3.png" alt="6.9753" style="width: 18px; height: 18px; padding: 4px;" />
                                        <span style="color: #1a1a1a; font-size: 0.85em;">6.9753m</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        <img src="styles/legend/24_10_4.png" alt="9.3000" style="width: 18px; height: 18px; padding: 4px;" />
                                        <span style="color: #1a1a1a; font-size: 0.85em;">9.3000m</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI Chat Widget - Removed -->
                    <div id="ai-chat-panel" class="ai-chat-panel">
                        <div class="ai-chat-header">
                            <div class="ai-chat-title">Chat with TOMAS</div>
                            <div class="ai-chat-actions">
                                <button id="ai-chat-docs" class="close-btn" title="Proxy setup (docs)">?</button>
                                <button id="ai-chat-settings" class="close-btn" title="Settings"></button>
                                <button id="ai-chat-close" class="close-btn" title="Close"></button>
                            </div>
                        </div>
                        <div id="ai-chat-body" class="ai-chat-body"></div>
                        <div class="ai-key-hint" id="ai-key-hint" style="display:none;">No API key set. Click  to add your OpenAI API key locally.</div>
                        <div class="ai-chat-input">
                            <input id="ai-chat-input" type="text" placeholder="Ask about the data..." />
                            <button id="ai-chat-send">Send</button>
                        </div>
                    </div>
                </div>
            
        </div>
        <script src="resources/qgis2web_expressions.js"></script>
        <script src="./resources/functions.js"></script>
        <script src="./resources/ol.js"></script>
        <script src="./resources/ol-layerswitcher.js"></script>
        <script src="resources/photon-geocoder-autocomplete.min.js"></script>
        <!-- Households_1.js - Required for layers.js -->
        <script src="layers/Households_1.js"></script>
        <!-- People_0.js - DISABLED: Hidden but kept in code for future use -->
        <!-- <script src="layers/People_0.js"></script> -->
        <script src="layers/AnalysisSummaryat24meters_9.js"></script><script src="layers/AggregationSummaryat24meters_10.js"></script><script src="layers/HazardAggregationSummaryat24meters_11.js"></script><script src="layers/Numberofpeopleat24meters_12.js"></script><script src="layers/AnalysisSummaryat25meters_13.js"></script><script src="layers/AggregationSummaryat25meters_14.js"></script><script src="layers/HazardAggregationSummaryat25meters_15.js"></script><script src="layers/Numberofpeopleat25meters_16.js"></script><script src="layers/AnalysisSummaryat27meters_17.js"></script><script src="layers/AggregationSummaryat27meters_18.js"></script><script src="layers/HazardAggregationSummaryat27meters_19.js"></script><script src="layers/Numberofpeopleat26meters_20.js"></script><script src="layers/AnalysisSummaryat27meters_21.js"></script><script src="layers/AggregationSummaryatat27meters_22.js"></script><script src="layers/HazardAggregationSummaryat27meters_23.js"></script><script src="layers/Numberofpeopleat27meters_24.js"></script><script src="layers/AnalysisSummaryat28meters_25.js"></script><script src="layers/AggregationSummaryat28meters_26.js"></script><script src="layers/HazardAggregationSummaryat28meters_27.js"></script><script src="layers/Numberofpeopleat28meters_28.js"></script><script src="layers/AnalysisSummaryat29meters_29.js"></script><script src="layers/AggregationSummaryat29meters_30.js"></script><script src="layers/HazardAggregationSummaryat29meters_31.js"></script><script src="layers/Numberofpeopleat29meters_32.js"></script><script src="layers/AnalysisSummaryat30meters_33.js"></script><script src="layers/AggregationSummaryfor30meters_34.js"></script><script src="layers/HazardAggregationSummaryat30meters_35.js"></script><script src="layers/Numberofpeopleaffectedat30meters_36.js"></script><script src="layers/Schools_37.js"></script><script src="layers/Roads_38.js"></script><script src="layers/Region2_39.js"></script><script src="layers/DB_0.js"></script>        <script src="layers/StoTomasHouseholdsjoined_layer_1.js"></script>
        <!-- Aggregation Summary files for Impact Report charts -->
        <script src="layers/Agregation Summary/24MetersAgrigationsummary_1.js"></script>
        <script src="layers/Agregation Summary/25MetersAggregationSummary_3.js"></script>
        <script src="layers/Agregation Summary/26MetersAggregationSummary_5.js"></script>
        <script src="layers/Agregation Summary/27MetersAggregationSummary_7.js"></script>
        <script src="layers/Agregation Summary/28MetersAggregationSummary_9.js"></script>
        <script src="layers/Agregation Summary/29MetersAggregationSummary_11.js"></script>
        <script src="layers/Agregation Summary/30MetersAggregationSummary_13.js"></script>
        <!-- Households_1_style.js - Required for layers.js -->
        <script src="styles/Households_1_style.js"></script>
        <!-- People_0_style.js - DISABLED: Hidden but kept in code for future use -->
        <!-- <script src="styles/People_0_style.js"></script> -->
        <script src="styles/AnalysisSummaryat24meters_9_style.js"></script><script src="styles/AggregationSummaryat24meters_10_style.js"></script><script src="styles/HazardAggregationSummaryat24meters_11_style.js"></script><script src="styles/Numberofpeopleat24meters_12_style.js"></script><script src="styles/AnalysisSummaryat25meters_13_style.js"></script><script src="styles/AggregationSummaryat25meters_14_style.js"></script><script src="styles/HazardAggregationSummaryat25meters_15_style.js"></script><script src="styles/Numberofpeopleat25meters_16_style.js"></script><script src="styles/AnalysisSummaryat27meters_17_style.js"></script><script src="styles/AggregationSummaryat27meters_18_style.js"></script><script src="styles/HazardAggregationSummaryat27meters_19_style.js"></script><script src="styles/Numberofpeopleat26meters_20_style.js"></script><script src="styles/AnalysisSummaryat27meters_21_style.js"></script><script src="styles/AggregationSummaryatat27meters_22_style.js"></script><script src="styles/HazardAggregationSummaryat27meters_23_style.js"></script><script src="styles/Numberofpeopleat27meters_24_style.js"></script><script src="styles/AnalysisSummaryat28meters_25_style.js"></script><script src="styles/AggregationSummaryat28meters_26_style.js"></script><script src="styles/HazardAggregationSummaryat28meters_27_style.js"></script><script src="styles/Numberofpeopleat28meters_28_style.js"></script><script src="styles/AnalysisSummaryat29meters_29_style.js"></script><script src="styles/AggregationSummaryat29meters_30_style.js"></script><script src="styles/HazardAggregationSummaryat29meters_31_style.js"></script><script src="styles/Numberofpeopleat29meters_32_style.js"></script><script src="styles/AnalysisSummaryat30meters_33_style.js"></script><script src="styles/AggregationSummaryfor30meters_34_style.js"></script><script src="styles/HazardAggregationSummaryat30meters_35_style.js"></script><script src="styles/Numberofpeopleaffectedat30meters_36_style.js"></script><script src="styles/Schools_37_style.js"></script><script src="styles/Roads_38_style.js"></script><script src="styles/Region2_39_style.js"></script><script src="styles/DB_0_style.js"></script><script src="styles/StoTomasHouseholdsjoined_layer_1_style.js"></script>
        
        <!-- Place a small safe-guard before layers/layers.js runs to avoid undefined style references -->
        <script>
        // Ensure any missing style helper used by layers.js won't throw at parse time.
        // Add placeholders only if they don't already exist.
        window.style_Numberofpeopleat24meters_12 = window.style_Numberofpeopleat24meters_12 || function(feature, resolution){
            // return null or a very simple style if OL expects a style object
            try {
                if (typeof ol !== 'undefined' && ol.style && ol.style.Style) {
                    return new ol.style.Style({
                        stroke: new ol.style.Stroke({ color: 'rgba(0,0,0,0.6)', width: 1 }),
                        fill: new ol.style.Fill({ color: 'rgba(255,255,255,0.01)' })
                    });
                }
            } catch (e) {}
            return null;
        };
        </script>

        <!-- existing layer/style/layers.js includes follow here (no change) -->
        <script src="./layers/layers.js" type="text/javascript"></script> 
        <script src="./resources/Autolinker.min.js"></script>
        <script src="./resources/qgis2web.js"></script>
        
        
        
        <script>
        // Global variables
        var regionLayer = null;
        var highlightLayer = null;
        var popupOverlay = null;
        var selectedFeatures = [];
        var peopleLayer = null;
        var householdLayers = [];
        var householdLayersVisible = false;
        // Global variable to store selected barangays for StoTomasHouseholdsjoined_layer_1 filtering
        var stoTomasFilteredBarangays = new Set();
        var barangaySelectionState = {
            options: [],
            selected: new Set()
        };
        var barangayDropdownInitialized = false;
        
        // Multiselect state for Region, Province, and Municipality
        var regionSelectionState = {
            options: [],
            selected: new Set()
        };
        var regionDropdownInitialized = false;
        
        var provinceSelectionState = {
            options: [],
            selected: new Set()
        };
        var provinceDropdownInitialized = false;
        
        var municipalitySelectionState = {
            options: [],
            selected: new Set()
        };
        var municipalityDropdownInitialized = false;
        
        /**
         * Updates the top pane position based on right pane and charts panel state.
         * Called when right pane is toggled or when top pane is shown.
         * Connected to: setupRightPaneToggle(), showPeopleTableFor()
         */
        /**
         * Updates the top pane position and width based on right pane and charts panel state.
         * Ensures smooth responsive behavior when right pane is toggled.
         * Called when right pane is toggled or when top pane is shown.
         * Connected to: setupRightPaneToggle(), showPeopleTableFor(), showChartsPanel(), hideChartsPanel()
         */
        function updateTopPanePosition() {
            var topNavBar = document.getElementById('top-navigation-bar');
            var mapContainer = document.getElementById('map-container');
            
            if (!topNavBar || !mapContainer) return;
            
            // Only update if navigation bar is visible
            if (topNavBar.style.display === 'none') return;
            
            var isChartsOpen = mapContainer.classList.contains('charts-open');
            
            // Calculate right position based on state (no right pane anymore)
            var rightValue;
            if (isChartsOpen) {
                rightValue = '400px'; // 400px charts panel only
            } else {
                rightValue = '0'; // No right pane
            }
            
            // Set the position with smooth transition
            topNavBar.style.right = rightValue;
            topNavBar.style.width = ''; // Clear any fixed width to allow auto calculation
            topNavBar.style.maxWidth = ''; // Clear any max-width restrictions
            topNavBar.style.transition = 'right 0.3s ease, left 0.3s ease, width 0.3s ease'; // Ensure smooth transition
            
            // Force all child elements to be responsive and fill available width
            var navContent = topNavBar.querySelector('.nav-content');
            var tableWrapper = topNavBar.querySelector('#people-table-wrapper');
            var table = topNavBar.querySelector('#people-24-table-inner');
            
            if (navContent) {
                navContent.style.width = '100%';
                navContent.style.maxWidth = '100%';
                navContent.style.minWidth = '0';
            }
            if (tableWrapper) {
                tableWrapper.style.width = '100%';
                tableWrapper.style.maxWidth = '100%';
                tableWrapper.style.minWidth = '0';
            }
            if (table) {
                table.style.width = '100%';
                table.style.maxWidth = '100%';
                table.style.minWidth = '0';
            }
            
            // Force a reflow to ensure changes take effect immediately
            void topNavBar.offsetHeight;
        }
        
        // Right pane toggle functionality removed - right pane has been deleted
        
        // Initialize map with base map and Region_2 layer visible
        // Setup offcanvas event listeners for map container adjustment
        function setupOffcanvasListeners() {
            // Right offcanvas removed - charts moved to bottom offcanvas
            // Bottom offcanvas listeners are handled by setupFloodExtentOffcanvasListeners()
            console.log('Right offcanvas listeners removed - charts moved to bottom offcanvas');
        }
        
        /**
         * Shows the bottom offcanvas when a flood extent is selected.
         * Updates the title with the selected flood extent and displays relevant information.
         * Called when flood extent dropdown changes to a valid meter value.
         * Connected to: hideFloodExtentOffcanvas(), setupFloodExtentListeners()
         * @param {string} extent - The flood extent meter value (e.g., '24', '25', '26', etc.)
         */
        function showFloodExtentOffcanvas(extent) {
            var offcanvasElement = document.getElementById('offcanvasBottom');
            if (!offcanvasElement) {
                console.warn('Bottom offcanvas element not found');
                return;
            }
            
            var mapContainer = document.getElementById('map-container');
            var titleElement = document.getElementById('offcanvasBottomLabel');
            var contentElement = document.getElementById('flood-extent-content');
            var chartsContainer = document.getElementById('bottom-pane-charts-container');
            var impactChartsContainer = document.getElementById('impact-report-charts-container');
            
            // Update title
            if (titleElement && extent) {
                titleElement.textContent = 'Flood Extent: ' + extent + ' Meters';
            }
            
            // Hide charts, show flood content
            if (chartsContainer) {
                chartsContainer.style.display = 'none';
            }
